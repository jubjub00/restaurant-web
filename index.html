<script>
    if(sessionStorage.user){
        window.location.href = './home.html'
    }
    
</script>
<!DOCTYPE html>
<html lang="en">
<head>
	<title>Login</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">	
	<link rel="icon" type="image/png" href="images/icons/favicon.ico"/>
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">	
	<link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<link href="./node_modules//toastr/build/toastr.css" rel="stylesheet"/>
	<link href="https://unpkg.com/nprogress@0.2.0/nprogress.css" rel="stylesheet" />
    <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
</head>
<body>
<div id="index">
	<div class="limiter">
		<div class="container-login100" style="background-image: url('images/bg.jfif');">
			<div class="wrap-login100">
				<form class="login100-form">
					<span class="login100-form-logo">
						<span class="iconify" data-icon="ic:outline-vpn-key" data-inline="false"></span>
					</span>
					<span class="login100-form-title p-b-34 p-t-27">
						Log in
					</span>
					<div class="wrap-input100" data-validate = "Enter username">
						<input class="input100" type="text" name="username" v-model=username placeholder="Username" required >
						<span class="focus-input100" data-placeholder="&#xf207;"></span>
					</div>
					<div class="wrap-input100" data-validate="Enter password">
						<input class="input100" type="password" name="pass" v-model=password placeholder="Password" required>
						<span class="focus-input100" data-placeholder="&#xf191;"></span>
					</div>
					<div class="row">
						<div class="col-md-6">
							<div class="container-login100-form-btn">
								<input type="button" class="login100-form-btn" data-bs-toggle="modal" data-bs-target="#myModal" value="Register">
							</div>
						</div>
						<div class="col-md-6">
							<div class="container-login100-form-btn">
								<input type="button" class="login100-form-btn" @click="login" value="Login">
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<div class="modal fade" id="myModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
						<div class="row" style="width: 100%;">
							<div class="col-md-6"><h4 class="modal-title">สมัครสมาชิก</h4></div>
							<div class="col-md-6" align="right">
								<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
						</div>
				</div>
				<div class="modal-body">
					<div class="form-group">
						<label for="name">name</label>
						<input type="text" v-model="name" class="form-control" required>
					</div>
					<div class="form-group">
						<label for="lastname">lastname</label>
						<input type="text" v-model="lastname" class="form-control" required>
					</div>
					<div class="form-group">
						<label for="telephone">telephone number</label>
						<input type="text" v-model="telephone" class="form-control" required>
					</div>
					<div class="form-group">
						<label for="address">address</label>
						<input type="text" v-model="address" class="form-control" required>
					</div>
					<div class="form-group">
						<label for="username">username</label>
						<input type="text" v-model="username" class="form-control" required>
					</div>
					<div class="form-group">
						<label for="password">password</label>
						<input type="text" v-model="password" class="form-control" required>
					</div>
				</div>
					<br>
					<div class="modal-footer">
						<div class="row" style="width: 100%;">
							<div class="col-md-6" align="left"></div>
							<div class="col-md-6" align="right">
								<input type="button"  @click="register" class="btn btn-success btn-xs" value="Register">
							</div>
						</div>
					</div>
			</div>
		</div>
	</div>
</div>	
	<script src="https://code.iconify.design/1/1.0.7/iconify.min.js"></script>
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
	<script src="vendor/animsition/js/animsition.min.js"></script>
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
	<script src="vendor/select2/select2.min.js"></script>
	<script src="vendor/daterangepicker/moment.min.js"></script>
	<script src="vendor/daterangepicker/daterangepicker.js"></script>
	<script src="vendor/countdowntime/countdowntime.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script src="./node_modules/toastr/build/toastr.min.js"></script>
	<script src="js/main.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script>
        var app = new Vue({
            el:"#index",
            data:{
				username:'',
				password:'',
				name:'',
				lastname:'',
				telephone:'',
				address:'',
            },
            methods:{
                login(){
					if(app.username == '' || app.password == ''){
						toastr.error('โปรดกรอกข้อมูลการเข้าสู่ระบบ','เกิดข้อผิดพลาด',{timeOut: 3000})
						return;
					}
					if(app.username == 'admin' && app.password == 'admin'){
						sessionStorage.user = 'ok'
						sessionStorage.admin = 'ok'
						window.location.href = './home.html'
					}
					endpoint.post('/login',{
						member_username:app.username,
						member_password:app.password
					})
					.then( function (res) {
						if(res.data.statusCode == 200){
							toastr.success('ยินดีต้อนรับคุณ'+res.data.data.member_name,'เข้าระบบสำเร็จ',{timeOut: 3000})
							sessionStorage.user = JSON.stringify(res.data.data)
							window.location.href = './home.html'
						}else{
							toastr.error('ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง','เกิดข้อผิดพลาด',{timeOut: 3000})
						}
					}).catch(function (error) {
						console.log(error);
					})
                },register(){
					if(app.username == '' || app.password == '' || app.name == '' || app.lastname == '' || app.telephone == '' ){
						toastr.error('โปรดกรอกข้อมูลในการสมัคร','เกิดข้อผิดพลาด',{timeOut: 3000})
						return;
					}
					endpoint.post('/member',{
						member_username:app.username,
						member_password:app.password,
						member_name : app.name,
						member_lastname : app.lastname,
						member_tel : app.telephone,
						member_address : app.telephone,
					})
					.then( function (res) {
						if(res.data.statusCode == 200){
							endpoint.post('/login',{
								member_username:app.username,
								member_password:app.password
							})
							.then( function (res) {
								if(res.data.statusCode == 200){
									toastr.success('ยินดีต้อนรับคุณ'+res.data.data.member_name,'เข้าระบบสำเร็จ',{timeOut: 3000})
									sessionStorage.user = JSON.stringify(res.data.data)
									window.location.href = './home.html'
								}else{
									toastr.error('ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง','เกิดข้อผิดพลาด',{timeOut: 3000})
								}
							}).catch(function (error) {
								console.log(error);
							})

						}else{
							toastr.error('ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง','เกิดข้อผิดพลาด',{timeOut: 3000})
						}
					}).catch(function (error) {
						console.log(error);
					})


				}
            }
        })
    </script>

</body>
</html>